Lab 06: Programming for EXTI0 Interrupt 
======================================

# Objective
The objective of this lab is to learn programming of SysTick timer of the microcontroller STM32F4xx.

# Description
In this project we will learn programming of SysTick timer with interrupt. Three tasks should be completed: 
1) create a new project Lab6 for SysTick programming, 

2) the generation of a delay time with SysTick timer, and 

3) the measurement of computation time in cycles a function will take.

# Procedure
1.	Create a new project Lab6 for SysTick programming.
    a.	Open the peripheral demo project SysTick and find all .c and .s files in the project.

    b.	You can create a new project Projects/Lab6 to replace the example project SysTick, following the guide to create a new project in Lab4a
    
    c.	Rebuild and debug the project.

2.	Understand functions included in the source code module main.c listed below: 
- ```int main(void);```
- ```void Delay(__IO uint32_t nTime);```
- ```void TimingDelay_Decrement(void);```

Answer the following questions for each function:

a.	What operations are completed?

b.	Where is the function called in the project?

c.	Is the function the part of an interrupt service routine?


### ```int main(void)```

- Operations Completed: Initialization of LEDs and 
- where is the function called in the project?: The main() function is never called in a program .
- Is the function the part of an interrupt service routine? NO

### ```void Delay(__IO uint32_t nTime)```
- Operations Completed: checks to see if the delay time is 0. If not SysTick makes all changes

- where is the function called in the project?: Called inside the while loop in the main function

- Is the function the part of an interrupt service routine? NO

### ```void TimingDelay_Decrement(void)```

- Operations Completed:  decrements TimingDelay if it's not zero 

- where is the function called in the project?: Called by the ```void SysTick_Handler(void)``` in stm32f4xx-it.c

- Is the function the part of an interrupt service routine? YES



3.	Understand the interrupt of SysTick Timer and explain 

a.	the interrupt configuration for SysTick timer:
  - ``` uint32_t SysTick_Config	(	uint32_t 	ticks	)``` initializes and starts the system Tick Timer and its interrupt. After this call, the SysTick timer creates interrupts with the specified time interval. Counter is in free running mode to generate periodical interrupts
    - Parameters: **ticks**: Number of ticks between two interrupts
    - Returns:
      - 0 - Success
      - 1 - Failure

b.	the time period at which the SysTick timer generates interrupts
- SystemCoreClock is 168MHz, by setting ``` SysTickLoadVal = SystemCoreClock / 1000; ``` we generate an interrupt every 168000 clock cycles which corresponds to ( 1 millisecond)

c.	the functions of interrupt service routine.
- The SysTick handler is defined in stm32f4xx-it.c  as following 
``` void SysTick_Handler(void){ TimingDelay_Decrement();} ``` 
- We just call TimingDelay_Decrement() function which decrements TimingDelay if it's not zero and increments interrupts through ```SysTickCnt++;```  



4.	Build and run the program. Detect the related digital outputs for control the LEDs to measure the delay time generated by Delay(50) and Delay(100).
5.	Modify the source module main.c so that we can measure with SysTick timer the number of system cycles a function may take.
•	Add the following two functions in the source code module main.c

uint32_t CycleNum(uint32_t N)
{
  uint32_t Cnt0, Cnt1, SysTickCnt0, tmp;

  SysTickCnt0 = SysTickCnt;
  Cnt0 = SysTick->VAL;
  //Add the function to be evaluated below.
  Fun1(N);
  //End of the function to be evaluated.
  Cnt1 = SysTick->VAL;
  tmp = (SysTickCnt - SysTickCnt0)*SysTickLoadVal + Cnt0-Cnt1;
  return tmp;
}

float Fun1(uint16_t Num)
{
  uint16_t i;
  float x=0, y=0;
  for (i=0; i<Num; i++)
  {
    x += 1;
    y +=x*x;
  }
  return y;
}

•	Add prototypes of the two new function after
/* Private function prototypes -----------------------------------------------*/
void Delay(__IO uint32_t nTime);

uint32_t CycleNum(uint32_t var1);
float Fun1(uint16_t Num);

•	Add the global variables at the private variable section:
/* Private variables ---------------------------------------------------------*/
static __IO uint32_t TimingDelay, SysTickCnt = 0;
uint32_t SysTickLoadVal, CycleNumVal, NRP = 10;

•	In the function main(void), replace the line  
  if (SysTick_Config(SystemCoreClock / 1000))
with two lines:
  SysTickLoadVal = SystemCoreClock / 1000; 
  if (SysTick_Config(SysTickLoadVal))  


•	In the function main(void), add the following line in the while(1) loop.
CycleNumVal = CycleNum(NRP);

•	In the function void TimingDelay_Decrement(void) add the line:
SysTickCnt++;        //Increment interrupts


6.	Rebuild, Download and Debug your project:
The project should be rebuilt with and without the floating-point unit (FPU), respectively so that you can compare the computation with and without FPU for the floating point computation. During the test, you should observe the CycleNumVal for each test and fill the form below.


| NRP | Cycle number with FPU | Cycle number without FPU |
|-----|-----------------------|--------------------------|
| 50  | 621                   | 6062                     |
| 40  | 501                   | 4852                     |
| 30  | 381                   | 3642                     |
| 20  | 261                   | 2432                     |
| 10  | 141                   | 1222                     |
| 5   | 81                    | 617                      |
| 3   | 57                    | 375                      |
| 1   | 33                    | 133                      |


Report:
1.	Submit your modified source code main.c for both tests.
2.	Understand the function: answer all the questions for understand the functions and SysTick Timer interrupt programming.
 
